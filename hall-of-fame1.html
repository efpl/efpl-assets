<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>eFPL Hall of Fame</title>
<link rel="preconnect" href="https://docs.google.com" crossorigin>
<link rel="preconnect" href="https://www.google.com" crossorigin>

<style>
:root{
  --navy-dark: #00143b;
  --navy-medium: #001a4d;
  --navy-light: #002060;
  --navy-lighter: #002b80;
  --yellow: #f9d71c;
  --yellow-dim: rgba(249, 215, 28, 0.85);
  --bg-primary: #000820;
  --text-primary: #ffffff;
  --text-secondary: #cbd5e1;
  --text-muted: #94a3b8;
  --border: rgba(249, 215, 28, 0.15);
  --border-strong: rgba(249, 215, 28, 0.35);
  --shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
  --shadow-lg: 0 10px 30px rgba(0, 0, 0, 0.4);
}

*, *::before, *::after { box-sizing: border-box; }

html { 
  background: linear-gradient(135deg, var(--bg-primary) 0%, #000a1a 100%);
  min-height: 100vh;
}

body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
  color: var(--text-primary);
  line-height: 1.4;
  -webkit-font-smoothing: antialiased;
}

.container {
  max-width: 100%;
  margin: 0 auto;
  padding: 20px;
}

/* Header */
.header {
  background: var(--navy-dark);
  border-radius: 16px;
  padding: 24px;
  margin-bottom: 24px;
  box-shadow: var(--shadow-lg);
  border: 1px solid var(--border);
}

.header-content {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 16px;
  flex-wrap: wrap;
}

.header-title {
  display: flex;
  align-items: center;
  gap: 12px;
  margin: 0;
}

.header-title h1 {
  font-size: 28px;
  font-weight: 800;
  margin: 0;
  color: var(--text-primary);
  text-shadow: 0 2px 10px rgba(249, 215, 28, 0.3);
}

.trophy-icon {
  font-size: 32px;
  filter: drop-shadow(0 2px 8px rgba(249, 215, 28, 0.5));
}

.badge {
  background: linear-gradient(135deg, var(--yellow), var(--yellow-dim));
  color: var(--navy-dark);
  padding: 8px 16px;
  border-radius: 999px;
  font-weight: 800;
  font-size: 13px;
  box-shadow: 0 4px 12px rgba(249, 215, 28, 0.4);
  letter-spacing: 0.02em;
}

/* Tabs */
.tabs-wrapper {
  background: var(--navy-dark);
  border-radius: 16px;
  padding: 8px;
  margin-bottom: 24px;
  box-shadow: var(--shadow);
  border: 1px solid var(--border);
  display: flex;
  gap: 8px;
}

.tab {
  flex: 1;
  appearance: none;
  border: 1px solid transparent;
  background: transparent;
  color: var(--text-secondary);
  padding: 12px 20px;
  border-radius: 12px;
  font-weight: 700;
  font-size: 15px;
  cursor: pointer;
  transition: all 0.2s ease;
  position: relative;
}

.tab:hover {
  color: var(--text-primary);
  background: rgba(249, 215, 28, 0.08);
  border-color: var(--border);
}

.tab.active {
  background: linear-gradient(135deg, rgba(249, 215, 28, 0.2), rgba(249, 215, 28, 0.12));
  color: var(--text-primary);
  border-color: var(--border-strong);
  box-shadow: 0 2px 8px rgba(249, 215, 28, 0.2);
}

/* Panel */
.panel {
  background: var(--navy-dark);
  border-radius: 16px;
  box-shadow: var(--shadow-lg);
  border: 1px solid var(--border);
  overflow: hidden;
}

.panel[hidden] { display: none; }

/* Table Container - NO SCROLL */
.table-container {
  overflow-x: visible;
  width: 100%;
}

/* Tables - Responsive, no scroll */
table {
  width: 100%;
  border-collapse: separate;
  border-spacing: 0;
  table-layout: fixed;
}

/* History table specific column widths */
#t-history {
  font-size: clamp(10px, 1.2vw, 14px);
}

#t-history thead th:nth-child(1) { width: 8%; min-width: 60px; } /* Season */
#t-history thead th:nth-child(2) { width: 12%; min-width: 80px; } /* Manager */
#t-history thead th:nth-child(n+3):nth-child(-n+11) { width: 7%; } /* Competition columns */
#t-history thead th:nth-child(12) { width: 8%; min-width: 50px; } /* Total */

/* Leaderboard table */
#t-leader {
  font-size: 14px;
}

thead {
  position: sticky;
  top: 0;
  z-index: 10;
}

thead th {
  background: var(--yellow);
  color: var(--navy-dark);
  font-size: clamp(9px, 1vw, 11px);
  text-transform: uppercase;
  letter-spacing: 0.03em;
  font-weight: 800;
  padding: 10px 4px;
  text-align: center;
  line-height: 1.2;
  vertical-align: middle;
  border-bottom: 3px solid var(--navy-dark);
  word-wrap: break-word;
  hyphens: auto;
}

thead th:nth-child(1),
thead th:nth-child(2) {
  text-align: left;
  padding-left: 12px;
}

thead th:nth-child(1) {
  border-radius: 16px 0 0 0;
}

thead th:last-child {
  border-radius: 0 16px 0 0;
  padding-right: 12px;
}

tbody tr {
  transition: all 0.15s ease;
}

tbody tr:nth-child(odd) {
  background: var(--navy-medium);
}

tbody tr:nth-child(even) {
  background: var(--navy-light);
}

tbody tr:hover {
  background: var(--navy-lighter);
  transform: scale(1.001);
}

tbody td {
  padding: 10px 4px;
  border-bottom: 1px solid rgba(0, 0, 0, 0.2);
  color: var(--text-primary);
  font-weight: 600;
  text-align: center;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

tbody td:nth-child(1),
tbody td:nth-child(2) {
  text-align: left;
  padding-left: 12px;
  font-weight: 700;
}

tbody td:last-child {
  padding-right: 12px;
  font-weight: 800;
}

tbody tr:last-child td {
  border-bottom: none;
}

tbody tr:last-child td:first-child {
  border-radius: 0 0 0 16px;
}

tbody tr:last-child td:last-child {
  border-radius: 0 0 16px 0;
}

/* Top 3 styling with yellow accents */
.rank-1 {
  background: linear-gradient(90deg, rgba(249, 215, 28, 0.25), var(--navy-medium)) !important;
  position: relative;
}

.rank-1 td:first-child::before {
  content: '';
  position: absolute;
  left: 0;
  top: 0;
  bottom: 0;
  width: 5px;
  background: linear-gradient(180deg, var(--yellow), var(--yellow-dim));
  border-radius: 0 4px 4px 0;
  box-shadow: 0 0 10px rgba(249, 215, 28, 0.6);
}

.rank-1 td:first-child {
  color: var(--yellow);
  font-size: 16px;
  text-shadow: 0 0 10px rgba(249, 215, 28, 0.5);
}

.rank-2 {
  background: linear-gradient(90deg, rgba(249, 215, 28, 0.15), var(--navy-light)) !important;
}

.rank-2 td:first-child {
  color: var(--yellow-dim);
}

.rank-3 {
  background: linear-gradient(90deg, rgba(249, 215, 28, 0.08), var(--navy-light)) !important;
}

.rank-3 td:first-child {
  color: var(--text-secondary);
}

/* Loading skeleton */
.skeleton {
  background: linear-gradient(90deg, 
    var(--navy-medium), 
    var(--navy-light), 
    var(--navy-medium)
  );
  background-size: 200% 100%;
  animation: shimmer 1.5s infinite;
  border-radius: 12px;
  min-height: 400px;
  margin: 24px;
}

@keyframes shimmer {
  0% { background-position: 200% 0; }
  100% { background-position: -200% 0; }
}

/* Error message */
.error {
  margin: 24px;
  padding: 16px 20px;
  border-radius: 12px;
  background: rgba(220, 38, 38, 0.15);
  border: 1px solid rgba(220, 38, 38, 0.4);
  color: #fca5a5;
  font-weight: 600;
  font-size: 14px;
}

/* Note */
.note {
  padding: 16px 24px;
  color: var(--text-muted);
  font-size: 13px;
  border-top: 1px solid var(--border);
  background: rgba(249, 215, 28, 0.03);
}

/* Abbreviation tooltip */
.abbr-hint {
  cursor: help;
  text-decoration: none;
  border-bottom: 1px dotted currentColor;
}

/* Mobile optimizations */
@media (max-width: 1200px) {
  #t-history {
    font-size: clamp(9px, 1.1vw, 12px);
  }
  
  thead th {
    padding: 8px 3px;
    font-size: clamp(8px, 0.9vw, 10px);
  }
  
  tbody td {
    padding: 8px 3px;
  }
}

@media (max-width: 768px) {
  .container { padding: 12px; }
  
  .header {
    padding: 20px;
    margin-bottom: 16px;
  }
  
  .header-content {
    flex-direction: column;
    align-items: flex-start;
  }
  
  .header-title h1 {
    font-size: 24px;
  }
  
  .tabs-wrapper {
    margin-bottom: 16px;
  }
  
  .tab {
    padding: 10px 16px;
    font-size: 14px;
  }
  
  #t-history {
    font-size: clamp(8px, 2vw, 11px);
  }
  
  thead th {
    padding: 8px 2px;
    font-size: clamp(7px, 1.8vw, 9px);
  }
  
  tbody td {
    padding: 8px 2px;
  }
  
  thead th:nth-child(1),
  tbody td:nth-child(1) {
    padding-left: 8px;
  }
  
  thead th:last-child,
  tbody td:last-child {
    padding-right: 8px;
  }
}

@media (max-width: 480px) {
  .header-title h1 {
    font-size: 20px;
  }
  
  .trophy-icon {
    font-size: 24px;
  }
  
  .badge {
    font-size: 11px;
    padding: 6px 12px;
  }
  
  #t-history {
    font-size: clamp(7px, 2.2vw, 10px);
  }
  
  thead th {
    padding: 6px 1px;
    font-size: clamp(6px, 2vw, 8px);
    letter-spacing: 0;
  }
  
  tbody td {
    padding: 6px 1px;
  }
}

/* Utility classes */
.hidden { display: none !important; }
</style>
</head>

<body>
<div class="container">
  <header class="header">
    <div class="header-content">
      <div class="header-title">
        <span class="trophy-icon">üèÜ</span>
        <h1>eFPL Hall of Fame</h1>
      </div>
      <span class="badge" id="updated">Loading‚Ä¶</span>
    </div>
  </header>

  <div class="tabs-wrapper">
    <button class="tab active" id="tab-history" role="tab">
      Season History
    </button>
    <button class="tab" id="tab-leaderboard" role="tab">
      Leaderboard
    </button>
  </div>

  <div class="panel" id="panel-history">
    <div id="sk-history" class="skeleton"></div>
    <div id="err-history" class="error hidden"></div>
    <div id="wrap-history" class="hidden">
      <div class="table-container">
        <table id="t-history"></table>
      </div>
      <div class="note">
        üí° All 12 columns displayed with responsive sizing - no scrolling needed
      </div>
    </div>
  </div>

  <div class="panel hidden" id="panel-leaderboard">
    <div id="sk-leader" class="skeleton"></div>
    <div id="err-leader" class="error hidden"></div>
    <div id="wrap-leader" class="hidden">
      <div class="table-container">
        <table id="t-leader"></table>
      </div>
      <div class="note">
        üéØ Ranked by total trophies won (highest first)
      </div>
    </div>
  </div>
</div>

<script>
/* ===== CONFIG ===== */
const SHEET_ID = "1DaYTkVVWiQVg7aianACoIfxXBZSKYqtycyuofX8WXj8";
const HISTORY_GID = "1032615815";
const LEADERBOARD_GID = "1964938799";
const HISTORY_RANGE = "A1:L";
const LEADER_RANGE = "A1:E";
const BUCKET_MS = 5 * 60 * 1000;
const CB = Math.floor(Date.now() / BUCKET_MS);

// Abbreviation mapping for long column names
const COLUMN_ABBREV = {
  'Season': 'Season',
  'Manager': 'Manager',
  'Premier League': 'PL',
  'Champions League': 'CL',
  'Europa League': 'EL',
  'FA Cup': 'FA',
  'League Cup': 'LC',
  'Community Shield': 'CS',
  'Club World Cup': 'CWC',
  'Super Cup': 'SC',
  'Championship': 'Champ',
  'Total': 'Total'
};

/* ===== Helpers ===== */
function esc(s) {
  return String(s ?? "")
    .replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;")
    .replace(/"/g, "&quot;").replace(/'/g, "&#39;");
}

function parseGviz(text) {
  const a = text.indexOf("{");
  const b = text.lastIndexOf("}");
  if (a === -1 || b === -1) throw new Error("Invalid GViz response");
  return JSON.parse(text.slice(a, b + 1));
}

function cellVal(c) {
  if (!c) return "";
  return (c.f ?? c.v ?? "");
}

function isNumeric(v) {
  return /^-?\d+(\.\d+)?$/.test(String(v).trim());
}

function abbreviateHeader(header) {
  // Use abbreviation if available and on smaller screens
  if (window.innerWidth < 1200) {
    return COLUMN_ABBREV[header] || header;
  }
  return header;
}

function renderTable(tableEl, cols, rows, opts = {}) {
  const headers = cols.map(c => c.label || "");
  const originalHeaders = [...headers];
  
  let html = "<thead><tr>";
  
  headers.forEach((h, i) => {
    const displayHeader = opts.history ? abbreviateHeader(h) : h;
    const title = opts.history && displayHeader !== h ? h : '';
    html += `<th title="${esc(title)}">${esc(displayHeader)}</th>`;
  });
  
  html += "</tr></thead><tbody>";

  for (let r = 0; r < rows.length; r++) {
    const row = rows[r].c || [];
    const vals = row.map(cellVal);

    if (vals.every(v => String(v).trim() === "")) continue;

    let trClass = "";
    if (opts.leaderboard) {
      const pos = parseInt(String(vals[0]).trim(), 10);
      if (pos === 1) trClass = "rank-1";
      else if (pos === 2) trClass = "rank-2";
      else if (pos === 3) trClass = "rank-3";
    }

    html += `<tr class="${trClass}">`;
    
    for (let i = 0; i < vals.length; i++) {
      const v = vals[i];
      html += `<td>${esc(v)}</td>`;
    }
    
    html += "</tr>";
  }

  html += "</tbody>";
  tableEl.innerHTML = html;
}

async function fetchGvizJSONByGid(gid, range) {
  const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?` +
    `tqx=out:json&gid=${encodeURIComponent(gid)}` +
    `&range=${encodeURIComponent(range)}&cachebust=${CB}`;
  const res = await fetch(url);
  const text = await res.text();
  if (!res.ok) throw new Error("HTTP " + res.status);
  return parseGviz(text);
}

function setUpdatedBadge(ok = true) {
  const el = document.getElementById("updated");
  if (!ok) {
    el.textContent = "‚ö†Ô∏è Check sharing";
    return;
  }
  const d = new Date();
  const pad = n => String(n).padStart(2, "0");
  el.textContent = `Updated ${pad(d.getDate())}/${pad(d.getMonth() + 1)}/${String(d.getFullYear()).slice(-2)}`;
}

/* ===== Loaders ===== */
async function loadHistory() {
  const sk = document.getElementById("sk-history");
  const err = document.getElementById("err-history");
  const wrap = document.getElementById("wrap-history");
  const t = document.getElementById("t-history");

  try {
    const json = await fetchGvizJSONByGid(HISTORY_GID, HISTORY_RANGE);
    renderTable(t, json.table.cols, json.table.rows || [], { history: true });
    sk.classList.add("hidden");
    wrap.classList.remove("hidden");
    err.classList.add("hidden");
    setUpdatedBadge(true);
  } catch (e) {
    sk.classList.add("hidden");
    wrap.classList.add("hidden");
    err.classList.remove("hidden");
    err.textContent = "‚ö†Ô∏è Could not load season history: " + e.message + " (Ensure the sheet is shared or published)";
    setUpdatedBadge(false);
  }
}

async function loadLeaderboard() {
  const sk = document.getElementById("sk-leader");
  const err = document.getElementById("err-leader");
  const wrap = document.getElementById("wrap-leader");
  const t = document.getElementById("t-leader");

  try {
    const json = await fetchGvizJSONByGid(LEADERBOARD_GID, LEADER_RANGE);
    renderTable(t, json.table.cols, json.table.rows || [], { leaderboard: true });
    sk.classList.add("hidden");
    wrap.classList.remove("hidden");
    err.classList.add("hidden");
    setUpdatedBadge(true);
  } catch (e) {
    sk.classList.add("hidden");
    wrap.classList.add("hidden");
    err.classList.remove("hidden");
    err.textContent = "‚ö†Ô∏è Could not load leaderboard: " + e.message + " (Ensure the sheet is shared or published)";
    setUpdatedBadge(false);
  }
}

/* ===== Tabs ===== */
const tabHistory = document.getElementById("tab-history");
const tabLeader = document.getElementById("tab-leaderboard");
const panelHistory = document.getElementById("panel-history");
const panelLeader = document.getElementById("panel-leaderboard");

let leaderLoaded = false;

function activate(which) {
  const isHistory = which === "history";
  
  tabHistory.classList.toggle("active", isHistory);
  tabLeader.classList.toggle("active", !isHistory);
  
  panelHistory.classList.toggle("hidden", !isHistory);
  panelLeader.classList.toggle("hidden", isHistory);

  if (!isHistory && !leaderLoaded) {
    leaderLoaded = true;
    loadLeaderboard();
  }
}

tabHistory.addEventListener("click", () => activate("history"));
tabLeader.addEventListener("click", () => activate("leader"));

// Handle window resize for responsive tables
let resizeTimer;
window.addEventListener("resize", () => {
  clearTimeout(resizeTimer);
  resizeTimer = setTimeout(() => {
    // Re-render active table on resize to update abbreviations
    const activePanel = document.querySelector(".panel:not(.hidden)");
    if (activePanel.id === "panel-history" && !document.getElementById("wrap-history").classList.contains("hidden")) {
      loadHistory();
    } else if (leaderLoaded && !document.getElementById("wrap-leader").classList.contains("hidden")) {
      loadLeaderboard();
    }
  }, 250);
});

// Initial load
loadHistory();
</script>
</body>
</html>