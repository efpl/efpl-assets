<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>eFPL Hall of Fame</title>
<link rel="preconnect" href="https://docs.google.com" crossorigin>
<link rel="preconnect" href="https://www.google.com" crossorigin>

<style>
:root{
  --navy-dark: #00143b;
  --navy-medium: #001a4d;
  --navy-light: #002060;
  --navy-lighter: #002b80;
  --yellow: #f9d71c;
  --yellow-dim: rgba(249, 215, 28, 0.85);
  --bg-primary: #000820;
  --text-primary: #ffffff;
  --text-secondary: #cbd5e1;
  --text-muted: #94a3b8;
  --border: rgba(249, 215, 28, 0.15);
  --border-strong: rgba(249, 215, 28, 0.35);
  --shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
  --shadow-lg: 0 10px 30px rgba(0, 0, 0, 0.4);
}

*, *::before, *::after { box-sizing: border-box; }

html { 
  background: linear-gradient(135deg, var(--bg-primary) 0%, #000a1a 100%);
  min-height: 100vh;
}

body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
  color: var(--text-primary);
  line-height: 1.6;
  -webkit-font-smoothing: antialiased;
}

.container {
  max-width: 1400px;
  margin: 0 auto;
  padding: 20px;
}

/* Header */
.header {
  background: var(--navy-dark);
  border-radius: 16px;
  padding: 24px;
  margin-bottom: 24px;
  box-shadow: var(--shadow-lg);
  border: 1px solid var(--border);
}

.header-content {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 16px;
  flex-wrap: wrap;
}

.header-title {
  display: flex;
  align-items: center;
  gap: 12px;
  margin: 0;
}

.header-title h1 {
  font-size: 28px;
  font-weight: 800;
  margin: 0;
  color: var(--text-primary);
  text-shadow: 0 2px 10px rgba(249, 215, 28, 0.3);
}

.trophy-icon {
  font-size: 32px;
  filter: drop-shadow(0 2px 8px rgba(249, 215, 28, 0.5));
}

.badge {
  background: linear-gradient(135deg, var(--yellow), var(--yellow-dim));
  color: var(--navy-dark);
  padding: 8px 16px;
  border-radius: 999px;
  font-weight: 800;
  font-size: 13px;
  box-shadow: 0 4px 12px rgba(249, 215, 28, 0.4);
  letter-spacing: 0.02em;
}

/* Tabs */
.tabs-wrapper {
  background: var(--navy-dark);
  border-radius: 16px;
  padding: 8px;
  margin-bottom: 24px;
  box-shadow: var(--shadow);
  border: 1px solid var(--border);
  display: flex;
  gap: 8px;
}

.tab {
  flex: 1;
  appearance: none;
  border: 1px solid transparent;
  background: transparent;
  color: var(--text-secondary);
  padding: 12px 20px;
  border-radius: 12px;
  font-weight: 700;
  font-size: 15px;
  cursor: pointer;
  transition: all 0.2s ease;
  position: relative;
}

.tab:hover {
  color: var(--text-primary);
  background: rgba(249, 215, 28, 0.08);
  border-color: var(--border);
}

.tab.active {
  background: linear-gradient(135deg, rgba(249, 215, 28, 0.2), rgba(249, 215, 28, 0.12));
  color: var(--text-primary);
  border-color: var(--border-strong);
  box-shadow: 0 2px 8px rgba(249, 215, 28, 0.2);
}

/* Panel */
.panel {
  background: var(--navy-dark);
  border-radius: 16px;
  box-shadow: var(--shadow-lg);
  border: 1px solid var(--border);
  overflow: hidden;
}

.panel[hidden] { display: none; }

/* Table Container */
.table-container {
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
}

/* Tables */
table {
  width: 100%;
  border-collapse: separate;
  border-spacing: 0;
  font-size: 14px;
}

thead {
  position: sticky;
  top: 0;
  z-index: 10;
}

thead th {
  background: var(--yellow);
  color: var(--navy-dark);
  font-size: 11px;
  text-transform: uppercase;
  letter-spacing: 0.06em;
  font-weight: 800;
  padding: 14px 12px;
  text-align: left;
  white-space: nowrap;
  border-bottom: 3px solid var(--navy-dark);
}

thead th:first-child {
  padding-left: 24px;
  border-radius: 16px 0 0 0;
}

thead th:last-child {
  padding-right: 24px;
  border-radius: 0 16px 0 0;
}

tbody tr {
  transition: all 0.15s ease;
}

tbody tr:nth-child(odd) {
  background: var(--navy-medium);
}

tbody tr:nth-child(even) {
  background: var(--navy-light);
}

tbody tr:hover {
  background: var(--navy-lighter);
  transform: scale(1.002);
}

tbody td {
  padding: 16px 12px;
  border-bottom: 1px solid rgba(0, 0, 0, 0.2);
  color: var(--text-primary);
  font-weight: 600;
}

tbody td:first-child {
  padding-left: 24px;
  font-weight: 900;
}

tbody td:last-child {
  padding-right: 24px;
}

tbody tr:last-child td {
  border-bottom: none;
}

tbody tr:last-child td:first-child {
  border-radius: 0 0 0 16px;
}

tbody tr:last-child td:last-child {
  border-radius: 0 0 16px 0;
}

/* Column alignment */
.text-left { text-align: left; }
.text-center { text-align: center; }
.text-right { text-align: right; }

/* Top 3 styling with yellow accents */
.rank-1 {
  background: linear-gradient(90deg, rgba(249, 215, 28, 0.25), var(--navy-medium)) !important;
  position: relative;
}

.rank-1 td:first-child::before {
  content: '';
  position: absolute;
  left: 0;
  top: 0;
  bottom: 0;
  width: 5px;
  background: linear-gradient(180deg, var(--yellow), var(--yellow-dim));
  border-radius: 0 4px 4px 0;
  box-shadow: 0 0 10px rgba(249, 215, 28, 0.6);
}

.rank-1 td:first-child {
  color: var(--yellow);
  font-size: 16px;
  text-shadow: 0 0 10px rgba(249, 215, 28, 0.5);
}

.rank-2 {
  background: linear-gradient(90deg, rgba(249, 215, 28, 0.15), var(--navy-light)) !important;
}

.rank-2 td:first-child {
  color: var(--yellow-dim);
}

.rank-3 {
  background: linear-gradient(90deg, rgba(249, 215, 28, 0.08), var(--navy-light)) !important;
}

.rank-3 td:first-child {
  color: var(--text-secondary);
}

/* Loading skeleton */
.skeleton {
  background: linear-gradient(90deg, 
    var(--navy-medium), 
    var(--navy-light), 
    var(--navy-medium)
  );
  background-size: 200% 100%;
  animation: shimmer 1.5s infinite;
  border-radius: 12px;
  min-height: 400px;
  margin: 24px;
}

@keyframes shimmer {
  0% { background-position: 200% 0; }
  100% { background-position: -200% 0; }
}

/* Error message */
.error {
  margin: 24px;
  padding: 16px 20px;
  border-radius: 12px;
  background: rgba(220, 38, 38, 0.15);
  border: 1px solid rgba(220, 38, 38, 0.4);
  color: #fca5a5;
  font-weight: 600;
  font-size: 14px;
}

/* Note */
.note {
  padding: 16px 24px;
  color: var(--text-muted);
  font-size: 13px;
  border-top: 1px solid var(--border);
  background: rgba(249, 215, 28, 0.03);
}

/* Responsive columns - hide on mobile */
@media (max-width: 768px) {
  .container { padding: 12px; }
  
  .header {
    padding: 20px;
    margin-bottom: 16px;
  }
  
  .header-content {
    flex-direction: column;
    align-items: flex-start;
  }
  
  .header-title h1 {
    font-size: 24px;
  }
  
  .tabs-wrapper {
    margin-bottom: 16px;
  }
  
  .tab {
    padding: 10px 16px;
    font-size: 14px;
  }
  
  thead th,
  tbody td {
    padding: 12px 8px;
    font-size: 13px;
  }
  
  thead th:first-child,
  tbody td:first-child {
    padding-left: 16px;
  }
  
  thead th:last-child,
  tbody td:last-child {
    padding-right: 16px;
  }
  
  /* Hide less important columns on mobile */
  .hide-mobile {
    display: none;
  }
  
  table {
    font-size: 12px;
  }
}

@media (max-width: 480px) {
  .header-title h1 {
    font-size: 20px;
  }
  
  .trophy-icon {
    font-size: 24px;
  }
  
  .badge {
    font-size: 11px;
    padding: 6px 12px;
  }
}

/* Utility classes */
.hidden { display: none !important; }
</style>
</head>

<body>
<div class="container">
  <header class="header">
    <div class="header-content">
      <div class="header-title">
        <span class="trophy-icon">üèÜ</span>
        <h1>eFPL Hall of Fame</h1>
      </div>
      <span class="badge" id="updated">Loading‚Ä¶</span>
    </div>
  </header>

  <div class="tabs-wrapper">
    <button class="tab active" id="tab-history" role="tab">
      Season History
    </button>
    <button class="tab" id="tab-leaderboard" role="tab">
      Leaderboard
    </button>
  </div>

  <div class="panel" id="panel-history">
    <div id="sk-history" class="skeleton"></div>
    <div id="err-history" class="error hidden"></div>
    <div id="wrap-history" class="hidden">
      <div class="table-container">
        <table id="t-history"></table>
      </div>
      <div class="note">
        üí° Scroll horizontally to view all competitions on smaller screens
      </div>
    </div>
  </div>

  <div class="panel hidden" id="panel-leaderboard">
    <div id="sk-leader" class="skeleton"></div>
    <div id="err-leader" class="error hidden"></div>
    <div id="wrap-leader" class="hidden">
      <div class="table-container">
        <table id="t-leader"></table>
      </div>
      <div class="note">
        üéØ Ranked by total trophies won (highest first)
      </div>
    </div>
  </div>
</div>

<script>
/* ===== CONFIG ===== */
const SHEET_ID = "1DaYTkVVWiQVg7aianACoIfxXBZSKYqtycyuofX8WXj8";
const HISTORY_GID = "1032615815";
const LEADERBOARD_GID = "1964938799";
const HISTORY_RANGE = "A1:L";
const LEADER_RANGE = "A1:E";
const BUCKET_MS = 5 * 60 * 1000;
const CB = Math.floor(Date.now() / BUCKET_MS);

/* ===== Helpers ===== */
function esc(s) {
  return String(s ?? "")
    .replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;")
    .replace(/"/g, "&quot;").replace(/'/g, "&#39;");
}

function parseGviz(text) {
  const a = text.indexOf("{");
  const b = text.lastIndexOf("}");
  if (a === -1 || b === -1) throw new Error("Invalid GViz response");
  return JSON.parse(text.slice(a, b + 1));
}

function cellVal(c) {
  if (!c) return "";
  return (c.f ?? c.v ?? "");
}

function isNumeric(v) {
  return /^-?\d+(\.\d+)?$/.test(String(v).trim());
}

function renderTable(tableEl, cols, rows, opts = {}) {
  const headers = cols.map(c => c.label || "");
  const isMobile = window.innerWidth <= 768;
  
  let html = "<thead><tr>";
  
  headers.forEach((h, i) => {
    // Mark columns that should hide on mobile (customize based on your needs)
    let hideClass = "";
    if (isMobile && opts.history && i > 2 && i < headers.length - 1) {
      // On mobile history view, keep first 3 and last column visible
      hideClass = "hide-mobile";
    }
    
    const align = i === 0 ? "text-left" : (i === 1 ? "text-left" : "text-center");
    html += `<th class="${align} ${hideClass}">${esc(h)}</th>`;
  });
  
  html += "</tr></thead><tbody>";

  for (let r = 0; r < rows.length; r++) {
    const row = rows[r].c || [];
    const vals = row.map(cellVal);

    if (vals.every(v => String(v).trim() === "")) continue;

    let trClass = "";
    if (opts.leaderboard) {
      const pos = parseInt(String(vals[0]).trim(), 10);
      if (pos === 1) trClass = "rank-1";
      else if (pos === 2) trClass = "rank-2";
      else if (pos === 3) trClass = "rank-3";
    }

    html += `<tr class="${trClass}">`;
    
    for (let i = 0; i < vals.length; i++) {
      const v = vals[i];
      let hideClass = "";
      if (isMobile && opts.history && i > 2 && i < vals.length - 1) {
        hideClass = "hide-mobile";
      }
      
      const align = i === 0 ? "text-left" : (i === 1 ? "text-left" : (isNumeric(v) ? "text-right" : "text-center"));
      html += `<td class="${align} ${hideClass}">${esc(v)}</td>`;
    }
    
    html += "</tr>";
  }

  html += "</tbody>";
  tableEl.innerHTML = html;
}

async function fetchGvizJSONByGid(gid, range) {
  const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?` +
    `tqx=out:json&gid=${encodeURIComponent(gid)}` +
    `&range=${encodeURIComponent(range)}&cachebust=${CB}`;
  const res = await fetch(url);
  const text = await res.text();
  if (!res.ok) throw new Error("HTTP " + res.status);
  return parseGviz(text);
}

function setUpdatedBadge(ok = true) {
  const el = document.getElementById("updated");
  if (!ok) {
    el.textContent = "‚ö†Ô∏è Check sharing";
    return;
  }
  const d = new Date();
  const pad = n => String(n).padStart(2, "0");
  el.textContent = `Updated ${pad(d.getDate())}/${pad(d.getMonth() + 1)}/${String(d.getFullYear()).slice(-2)}`;
}

/* ===== Loaders ===== */
async function loadHistory() {
  const sk = document.getElementById("sk-history");
  const err = document.getElementById("err-history");
  const wrap = document.getElementById("wrap-history");
  const t = document.getElementById("t-history");

  try {
    const json = await fetchGvizJSONByGid(HISTORY_GID, HISTORY_RANGE);
    renderTable(t, json.table.cols, json.table.rows || [], { history: true });
    sk.classList.add("hidden");
    wrap.classList.remove("hidden");
    err.classList.add("hidden");
    setUpdatedBadge(true);
  } catch (e) {
    sk.classList.add("hidden");
    wrap.classList.add("hidden");
    err.classList.remove("hidden");
    err.textContent = "‚ö†Ô∏è Could not load season history: " + e.message + " (Ensure the sheet is shared or published)";
    setUpdatedBadge(false);
  }
}

async function loadLeaderboard() {
  const sk = document.getElementById("sk-leader");
  const err = document.getElementById("err-leader");
  const wrap = document.getElementById("wrap-leader");
  const t = document.getElementById("t-leader");

  try {
    const json = await fetchGvizJSONByGid(LEADERBOARD_GID, LEADER_RANGE);
    renderTable(t, json.table.cols, json.table.rows || [], { leaderboard: true });
    sk.classList.add("hidden");
    wrap.classList.remove("hidden");
    err.classList.add("hidden");
    setUpdatedBadge(true);
  } catch (e) {
    sk.classList.add("hidden");
    wrap.classList.add("hidden");
    err.classList.remove("hidden");
    err.textContent = "‚ö†Ô∏è Could not load leaderboard: " + e.message + " (Ensure the sheet is shared or published)";
    setUpdatedBadge(false);
  }
}

/* ===== Tabs ===== */
const tabHistory = document.getElementById("tab-history");
const tabLeader = document.getElementById("tab-leaderboard");
const panelHistory = document.getElementById("panel-history");
const panelLeader = document.getElementById("panel-leaderboard");

let leaderLoaded = false;

function activate(which) {
  const isHistory = which === "history";
  
  tabHistory.classList.toggle("active", isHistory);
  tabLeader.classList.toggle("active", !isHistory);
  
  panelHistory.classList.toggle("hidden", !isHistory);
  panelLeader.classList.toggle("hidden", isHistory);

  if (!isHistory && !leaderLoaded) {
    leaderLoaded = true;
    loadLeaderboard();
  }
}

tabHistory.addEventListener("click", () => activate("history"));
tabLeader.addEventListener("click", () => activate("leader"));

// Handle window resize for responsive tables
let resizeTimer;
window.addEventListener("resize", () => {
  clearTimeout(resizeTimer);
  resizeTimer = setTimeout(() => {
    // Re-render active table on resize
    const activePanel = document.querySelector(".panel:not(.hidden)");
    if (activePanel.id === "panel-history" && !document.getElementById("wrap-history").classList.contains("hidden")) {
      loadHistory();
    } else if (leaderLoaded && !document.getElementById("wrap-leader").classList.contains("hidden")) {
      loadLeaderboard();
    }
  }, 250);
});

// Initial load
loadHistory();
</script>
</body>
</html>