<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>eFPL Crystal Standings — Season 2</title>

<!-- Speed: preconnect to Google Sheets -->
<link rel="preconnect" href="https://docs.google.com" crossorigin>
<link rel="preconnect" href="https://www.google.com" crossorigin>

<style>
:root {
  --bg: #00143b;
  --text: #ffffff;
  --muted: #b8c6e3;
  --accent: #f9d71c;
  --accent-soft: rgba(249, 215, 28, 0.1);
  --accent-strong: rgba(249, 215, 28, 0.45);
  --row-top: #0b1636;
  --row-mid: #0f1e49;
  --row-bot: #152a5e;
  --champ-bg: linear-gradient(90deg, rgba(249,215,28,0.15), rgba(255,255,255,0.02));
  --pill-w: #16a34a;
  --pill-d: #e5e7eb;
  --pill-l: #dc2626;
}
html, body {
  margin: 0;
  padding: 0;
  background: transparent;
  color: var(--text);
  font-family: "Segoe UI", Arial, sans-serif;
  font-size: 15px;
}
.wrap {
  max-width: 1020px;
  margin: 24px auto;
  padding: 16px;
}
.card {
  background: var(--bg);
  border-radius: 16px;
  overflow: hidden;
  box-shadow: 0 8px 20px rgba(0,0,0,0.4);
}

/* Header */
.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 16px;
  background: rgba(255,255,255,0.04);
  border-bottom: 1px solid var(--accent-strong);
}
.header h1 {
  font-size: 20px;
  font-weight: 800;
  margin: 0;
  display: flex;
  align-items: center;
  gap: 10px;
}
.header .badge {
  background: var(--accent);
  color: #000;
  padding: 6px 14px;
  border-radius: 999px;
  font-weight: 700;
  font-size: 13px;
}

/* Table */
table {
  width: 100%;
  border-collapse: collapse;
}
thead th {
  background: var(--accent);
  color: #0b1b3d;
  font-size: 12px;
  text-transform: uppercase;
  letter-spacing: 0.04em;
  padding: 12px;
  text-align: center;
}
tbody td {
  padding: 14px 12px;
  font-weight: 500;
  text-align: center;
}
tbody td.team {
  text-align: left;
  font-weight: 700;
}
tbody tr {
  transition: background 0.2s ease;
}
tbody tr:hover {
  background: rgba(255,255,255,0.05);
}

/* Highlight bands */
tbody tr.pos-1 td {
  background: var(--champ-bg);
  font-weight: 800;
  position: relative;
}
tbody tr.pos-1 td:first-child::before {
  content: "\1F451";
  margin-right: 6px;
  display: inline-block;
}
tbody tr.pos-2-4 td {
  background: var(--row-top);
}
tbody tr.pos-5-8 td {
  background: var(--row-mid);
}
tbody tr.pos-9-10 td {
  background: var(--row-bot);
}

/* Form */
.form {
  display: inline-flex;
  gap: 4px;
}
.fpill {
  display: inline-block;
  width: 18px;
  height: 18px;
  font-size: 10px;
  font-weight: 800;
  line-height: 18px;
  text-align: center;
  border-radius: 4px;
  color: #fff;
  background: #ccc;
}
.f-W { background: var(--pill-w); }
.f-D { background: var(--pill-d); color: #000; }
.f-L { background: var(--pill-l); }

/* Footer */
.footer {
  padding: 14px;
  text-align: center;
  font-size: 13px;
  color: var(--muted);
  border-top: 1px solid rgba(255,255,255,0.1);
}
.footer img {
  height: 26px;
  vertical-align: middle;
  margin: 0 6px;
}
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <div class="header">
      <h1>
        <img src="https://efpl-assets.pages.dev/img/instant-gaming.png" alt="Sponsor" height="26">
        Crystal League – Season 2
      </h1>
      <div class="badge" id="updated">Loading…</div>
    </div>

    <table id="standings-table"></table>

    <div class="footer">
      This league is sponsored by
      <a href="https://www.instant-gaming.com/?igr=eFPL" target="_blank" rel="noopener noreferrer nofollow">
        <img src="https://efpl-assets.pages.dev/img/instant-gaming.png" alt="Instant Gaming">
      </a>
      — Save up to <strong>90%</strong> on all digital games!
    </div>
  </div>
</div>

<script>
const SHEET_ID = '1LqRM7ICWpENmsKH5tTuu7Bf7VQa7YoJ-9TAivruymvo';
const SHEET_TAB = 'Embed';
const RANGE = 'A1:K11';
const CB = Math.floor(Date.now() / (5 * 60 * 1000));

function esc(s) {
  return String(s).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
}
function isNumeric(v) {
  return /^-?\d+(\.\d+)?$/.test(String(v));
}
function parseGviz(t) {
  const a = t.indexOf('{'), b = t.lastIndexOf('}');
  return JSON.parse(t.slice(a, b + 1));
}
function renderForm(s) {
  const raw = String(s ?? '').replace(/[\s,._|\\/\-]+/g, '').toUpperCase().replace(/[^WDL]/g, '').slice(-5);
  if (!raw) return '';
  return '<span class="form">' + [...raw].map(ch => `<span class="fpill f-${ch}">${ch}</span>`).join('') + '</span>';
}
async function loadTable() {
  const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=${encodeURIComponent(SHEET_TAB)}&range=${encodeURIComponent(RANGE)}&cachebust=${CB}`;
  const res = await fetch(url);
  const txt = await res.text();
  const json = parseGviz(txt);
  const headers = json.table.cols.map(c => c.label || '');
  const rows = json.table.rows.map(r => r.c.map(c => c ? c.f || c.v || '' : ''));
  const iForm = headers.findIndex(h => h.toLowerCase().includes('form'));

  let html = '<thead><tr>' + headers.map(h => `<th>${esc(h)}</th>`).join('') + '</tr></thead><tbody>';
  for (let i = 0; i < rows.length; i++) {
    const r = rows[i];
    const posClass = i === 0 ? 'pos-1' : i < 4 ? 'pos-2-4' : i < 8 ? 'pos-5-8' : 'pos-9-10';
    html += `<tr class="${posClass}">`;
    r.forEach((cell, j) => {
      const s = esc(cell);
      const val = j === iForm ? renderForm(cell) : s;
      const cls = j === 1 ? 'team' : (isNumeric(s) ? 'right' : '');
      html += `<td class="${cls}">${val}</td>`;
    });
    html += '</tr>';
  }
  html += '</tbody>';
  document.getElementById('standings-table').innerHTML = html;
  const now = new Date(), pad = n => String(n).padStart(2, '0');
  document.getElementById('updated').textContent = `Updated ${pad(now.getDate())}/${pad(now.getMonth()+1)}/${String(now.getFullYear()).slice(-2)}`;
}
loadTable();
</script>
</body>
</html>
