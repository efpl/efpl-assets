<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>eFPL Hall of Fame</title>
<meta name="color-scheme" content="dark">
<link rel="preconnect" href="https://docs.google.com" crossorigin>
<style>
:root{
  --bg:#0a1128;
  --bg-elevated:#13265b;
  --card:#0f1e49;
  --card-hover:#1a2d5f;
  --ink:#fff;
  --ink-muted:#8b9dc3;
  --accent:#f9d71c;
  --accent-dim:#d4b617;
  --line:rgba(249,215,28,.2);
  --success:#00ff87;
  --shadow-sm:0 2px 8px rgba(0,0,0,.3);
  --shadow-md:0 8px 24px rgba(0,0,0,.5);
  --shadow-lg:0 16px 48px rgba(0,0,0,.7);
}
*{box-sizing:border-box;margin:0;padding:0}
html,body{background:var(--bg);color:var(--ink);font:15px/1.6 -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif;-webkit-font-smoothing:antialiased}
img{max-width:100%;height:auto;display:block}

.hero{
  background:linear-gradient(135deg,#13265b 0%,#0a1128 100%);
  border-bottom:3px solid var(--accent);
  padding:24px 16px;
  position:relative;
  overflow:hidden;
}
.hero::before{
  content:'';
  position:absolute;
  inset:0;
  background:url('data:image/svg+xml,<svg width="100" height="100" xmlns="http://www.w3.org/2000/svg"><defs><pattern id="grid" width="100" height="100" patternUnits="userSpaceOnUse"><path d="M 100 0 L 0 0 0 100" fill="none" stroke="rgba(249,215,28,0.03)" stroke-width="1"/></pattern></defs><rect width="100%" height="100%" fill="url(%23grid)"/></svg>');
  pointer-events:none;
}
.hero-inner{
  max-width:1280px;
  margin:0 auto;
  display:flex;
  align-items:center;
  gap:16px;
  position:relative;
  z-index:1;
}
.hero-logo{
  width:56px;
  height:56px;
  border-radius:12px;
  box-shadow:0 4px 16px rgba(249,215,28,.4);
  border:2px solid var(--accent);
}
.hero-text h1{
  font-size:28px;
  font-weight:900;
  letter-spacing:-.5px;
  background:linear-gradient(135deg,#fff 0%,#f9d71c 100%);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  background-clip:text;
}
.hero-text p{
  font-size:13px;
  color:var(--ink-muted);
  margin-top:2px;
  text-transform:uppercase;
  letter-spacing:.08em;
  font-weight:600;
}

.container{
  max-width:1280px;
  margin:0 auto;
  padding:20px 16px;
}

.tabs{
  display:flex;
  gap:0;
  border-bottom:2px solid rgba(255,255,255,.08);
  margin-bottom:24px;
  overflow-x:auto;
  -webkit-overflow-scrolling:touch;
}
.tabs::-webkit-scrollbar{height:0}
.tab{
  background:transparent;
  border:0;
  color:var(--ink-muted);
  padding:14px 24px;
  font-weight:700;
  font-size:14px;
  cursor:pointer;
  white-space:nowrap;
  transition:all .2s;
  border-bottom:3px solid transparent;
}
.tab:hover{
  color:var(--ink);
  background:rgba(255,255,255,.03);
}
.tab.active{
  color:var(--accent);
  border-bottom-color:var(--accent);
}

.stats-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(140px,1fr));
  gap:12px;
  margin-bottom:24px;
}
.stat-card{
  background:var(--card);
  border:1px solid var(--line);
  border-radius:12px;
  padding:16px;
  position:relative;
  overflow:hidden;
  box-shadow:var(--shadow-sm);
  transition:all .2s;
}
.stat-card:hover{
  transform:translateY(-2px);
  box-shadow:var(--shadow-md);
  border-color:var(--accent);
}
.stat-card::before{
  content:'';
  position:absolute;
  top:0;
  right:0;
  width:60px;
  height:60px;
  background:radial-gradient(circle,var(--accent) 0%,transparent 70%);
  opacity:.05;
}
.stat-label{
  font-size:11px;
  text-transform:uppercase;
  letter-spacing:.08em;
  color:var(--ink-muted);
  font-weight:700;
  margin-bottom:6px;
}
.stat-value{
  font-size:32px;
  font-weight:900;
  color:var(--accent);
  line-height:1;
  font-variant-numeric:tabular-nums;
}

.section-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:16px;
  flex-wrap:wrap;
  gap:12px;
}
.section-title{
  font-size:20px;
  font-weight:900;
  display:flex;
  align-items:center;
  gap:8px;
}
.section-title::before{
  content:'';
  width:4px;
  height:24px;
  background:var(--accent);
  border-radius:2px;
}
.section-subtitle{
  font-size:13px;
  color:var(--ink-muted);
  margin-top:4px;
}

.table-container{
  background:var(--card);
  border:1px solid var(--line);
  border-radius:12px;
  overflow:hidden;
  box-shadow:var(--shadow-md);
  margin-bottom:24px;
}
.table-scroll{
  overflow-x:auto;
  -webkit-overflow-scrolling:touch;
}
.table{
  width:100%;
  border-collapse:collapse;
  min-width:600px;
}
.table thead{
  background:linear-gradient(135deg,#1a2d5f 0%,#13265b 100%);
  border-bottom:2px solid var(--accent);
}
.table th{
  padding:14px 16px;
  text-align:left;
  font-size:11px;
  text-transform:uppercase;
  letter-spacing:.08em;
  font-weight:800;
  color:var(--ink-muted);
  white-space:nowrap;
}
.table tbody tr{
  border-bottom:1px solid rgba(255,255,255,.05);
  transition:all .15s;
}
.table tbody tr:hover{
  background:var(--card-hover);
}
.table td{
  padding:14px 16px;
  font-weight:600;
  font-size:14px;
}
.table .center{text-align:center}
.table .right{text-align:right}

.rank{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  width:32px;
  height:32px;
  border-radius:8px;
  font-weight:900;
  font-size:14px;
  background:rgba(255,255,255,.05);
  border:2px solid rgba(255,255,255,.1);
}
.rank.gold{
  background:linear-gradient(135deg,#ffd700 0%,#ffed4e 100%);
  color:#1a1a1a;
  border-color:#ffd700;
  box-shadow:0 4px 12px rgba(255,215,0,.4);
}
.rank.silver{
  background:linear-gradient(135deg,#c0c0c0 0%,#e8e8e8 100%);
  color:#1a1a1a;
  border-color:#c0c0c0;
  box-shadow:0 4px 12px rgba(192,192,192,.3);
}
.rank.bronze{
  background:linear-gradient(135deg,#cd7f32 0%,#e8a87c 100%);
  color:#1a1a1a;
  border-color:#cd7f32;
  box-shadow:0 4px 12px rgba(205,127,50,.3);
}

.badge{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  padding:6px 12px;
  border-radius:6px;
  font-size:12px;
  font-weight:800;
  white-space:nowrap;
}
.badge.primary{
  background:linear-gradient(135deg,var(--accent) 0%,var(--accent-dim) 100%);
  color:#0a1128;
}
.badge.secondary{
  background:rgba(255,255,255,.08);
  border:1px solid rgba(255,255,255,.15);
  color:var(--ink);
}
.badge.success{
  background:rgba(0,255,135,.15);
  border:1px solid rgba(0,255,135,.3);
  color:var(--success);
}

.player-link{
  color:var(--ink);
  text-decoration:none;
  font-weight:700;
  cursor:pointer;
  transition:all .2s;
  position:relative;
}
.player-link:hover{
  color:var(--accent);
}

.comp-name{
  display:flex;
  align-items:center;
  gap:10px;
}
.comp-icon{
  width:24px;
  height:24px;
  border-radius:6px;
  object-fit:contain;
  box-shadow:0 2px 8px rgba(0,0,0,.4);
  flex-shrink:0;
}

.season-item{
  background:var(--card);
  border:1px solid var(--line);
  border-radius:12px;
  margin-bottom:12px;
  overflow:hidden;
  box-shadow:var(--shadow-sm);
  transition:all .2s;
}
.season-item:hover{
  box-shadow:var(--shadow-md);
}
.season-header{
  padding:16px 20px;
  cursor:pointer;
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:16px;
  background:linear-gradient(90deg,rgba(249,215,28,.08) 0%,transparent 100%);
  transition:all .2s;
}
.season-header:hover{
  background:linear-gradient(90deg,rgba(249,215,28,.12) 0%,transparent 100%);
}
.season-info{
  flex:1;
  min-width:0;
}
.season-name{
  font-size:16px;
  font-weight:900;
}
.season-meta{
  font-size:12px;
  color:var(--ink-muted);
  margin-top:2px;
  font-weight:600;
}
.season-chevron{
  color:var(--accent);
  font-size:20px;
  font-weight:900;
  transition:transform .2s;
}
.season-body{
  display:none;
  padding:20px;
  border-top:1px solid rgba(255,255,255,.05);
}

.podium{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
  gap:12px;
  margin-bottom:20px;
}
.podium-card{
  background:rgba(0,0,0,.2);
  border:1px solid rgba(255,255,255,.1);
  border-radius:10px;
  padding:14px;
  transition:all .2s;
}
.podium-card:hover{
  transform:translateY(-2px);
  border-color:var(--accent);
}
.podium-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:8px;
}
.podium-player{
  font-weight:700;
  font-size:15px;
}
.podium-subtitle{
  font-size:12px;
  color:var(--ink-muted);
  margin-top:4px;
}

.flyout{
  position:fixed;
  z-index:9999;
  background:var(--bg-elevated);
  border:2px solid var(--accent);
  border-radius:12px;
  padding:20px;
  box-shadow:var(--shadow-lg);
  min-width:280px;
  max-width:90vw;
  display:none;
}
.flyout-header{
  border-bottom:2px solid var(--line);
  padding-bottom:12px;
  margin-bottom:12px;
}
.flyout-name{
  font-size:18px;
  font-weight:900;
  color:var(--accent);
}
.flyout-subtitle{
  font-size:12px;
  color:var(--ink-muted);
  text-transform:uppercase;
  letter-spacing:.08em;
  margin-top:4px;
}
.flyout-stats{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:10px;
  margin-bottom:12px;
}
.flyout-stat{
  background:rgba(0,0,0,.3);
  border:1px solid rgba(255,255,255,.1);
  border-radius:8px;
  padding:10px;
}
.flyout-stat-label{
  font-size:10px;
  text-transform:uppercase;
  letter-spacing:.08em;
  color:var(--ink-muted);
  font-weight:700;
}
.flyout-stat-value{
  font-size:20px;
  font-weight:900;
  color:var(--accent);
  margin-top:4px;
}
.flyout-breakdown{
  max-height:200px;
  overflow-y:auto;
}
.flyout-item{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:8px 0;
  border-bottom:1px solid rgba(255,255,255,.05);
  gap:12px;
}
.flyout-item:last-child{border-bottom:0}

.select{
  background:var(--card);
  color:var(--ink);
  border:1px solid var(--line);
  border-radius:8px;
  padding:8px 12px;
  font-size:13px;
  font-weight:700;
  cursor:pointer;
  transition:all .2s;
}
.select:hover{
  border-color:var(--accent);
}

.panel{display:block}
.panel[hidden]{display:none}

@media(max-width:640px){
  .hero-text h1{font-size:22px}
  .hero-logo{width:48px;height:48px}
  .stats-grid{grid-template-columns:repeat(2,1fr)}
  .stat-value{font-size:24px}
  .section-title{font-size:18px}
  .table{min-width:500px}
  .tab{padding:12px 16px;font-size:13px}
}

@media(min-width:768px){
  .container{padding:32px 24px}
  .hero{padding:32px 24px}
  .podium{grid-template-columns:repeat(3,1fr)}
}
</style>
</head>

<body>
<header class="hero">
  <div class="hero-inner">
    <img src="https://efpl-assets.pages.dev/img/logo.png" alt="eFPL" class="hero-logo">
    <div class="hero-text">
      <h1>Hall of Fame</h1>
      <p>Official League Statistics & Records</p>
    </div>
  </div>
</header>

<div class="container">
  <nav class="tabs">
    <button class="tab active" data-tab="leaderboard" onclick="showTab('leaderboard')">All-Time Leaders</button>
    <button class="tab" data-tab="stats" onclick="showTab('stats')">Statistics</button>
    <button class="tab" data-tab="history" onclick="showTab('history')">Season Archive</button>
  </nav>

  <section class="panel" id="leaderboard">
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-label">Total Players</div>
        <div class="stat-value" id="quick-players">-</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Trophies Won</div>
        <div class="stat-value" id="quick-trophies">-</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Seasons</div>
        <div class="stat-value" id="quick-seasons">-</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Competitions</div>
        <div class="stat-value" id="quick-comps">-</div>
      </div>
    </div>

    <div class="section-header">
      <div>
        <div class="section-title">‚ö° All-Time Leaderboard</div>
        <div class="section-subtitle">Career trophy leaders across all competitions</div>
      </div>
    </div>

    <div class="table-container">
      <div class="table-scroll">
        <table class="table" id="t-leader"></table>
      </div>
    </div>
  </section>

  <section class="panel" id="stats" hidden>
    <div class="section-header">
      <div>
        <div class="section-title">üî• Most Dominant Players</div>
        <div class="section-subtitle">Highest trophy counts and win percentages</div>
      </div>
    </div>
    <div class="table-container">
      <div class="table-scroll">
        <table class="table" id="t-dominant"></table>
      </div>
    </div>

    <div class="section-header">
      <div>
        <div class="section-title">üéØ Competition Specialists</div>
        <div class="section-subtitle">Players who dominate specific competitions</div>
      </div>
    </div>
    <div class="table-container">
      <div class="table-scroll">
        <table class="table" id="t-specialists"></table>
      </div>
    </div>

    <div class="section-header">
      <div>
        <div class="section-title">üèÜ Trophy Diversity</div>
        <div class="section-subtitle">Most versatile champions across competition types</div>
      </div>
    </div>
    <div class="table-container">
      <div class="table-scroll">
        <table class="table" id="t-diversity"></table>
      </div>
    </div>
  </section>

  <section class="panel" id="history" hidden>
    <div class="section-header">
      <div>
        <div class="section-title">üìö Season Archive</div>
        <div class="section-subtitle">Complete historical records by season</div>
      </div>
      <div style="display:flex;gap:8px;align-items:center">
        <select id="seasonFilter" class="select" onchange="applySeasonFilter()">
          <option value="all">All Seasons</option>
        </select>
        <span class="badge primary" id="season-count">-</span>
      </div>
    </div>

    <div id="seasonCards"></div>
  </section>
</div>

<div class="flyout" id="flyout"></div>

<script>
const SHEET_ID="1DaYTkVVWiQVg7aianACoIfxXBZSKYqtycyuofX8WXj8";
const HISTORY_GID="1032615815";
const EFPL_LOGO="https://efpl-assets.pages.dev/img/logo.png";
const LEAGUE_ICON_BASE="https://efpl-assets.pages.dev/img/leagues/";

let HISTORY={headers:[],rows:[]};
let COMPETITIONS=[];
let COUNTS=null;
let ACTIVE_SEASON_FILTER="all";

const esc=s=>String(s??'').replace(/[&<>"]/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[m]));
const gv=(gid,range)=>fetch(`https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&gid=${gid}&range=${range}`)
  .then(r=>r.text())
  .then(t=>JSON.parse(t.slice(t.indexOf('{'),t.lastIndexOf('}')+1)));
const val=c=>(c&&(c.v??c.f))??"";
const key=x=>String(x??"").trim();
const byId=id=>document.getElementById(id);
const normName=s=>String(s??"").trim().replace(/\s+/g," ");

function seasonLabel(raw){
  const s=String(raw??"").trim();
  if(/^\d+$/.test(s))return`Season ${s}`;
  if(/^season\b/i.test(s))return s;
  return s;
}

function safeSeasonSortKey(seasonStr){
  const m=String(seasonStr??"").match(/(\d+)/);
  return m?Number(m[1]):-1;
}

function compIconUrl(label){
  const s=String(label||"").toLowerCase();
  if(s.includes("diamond"))return LEAGUE_ICON_BASE+"Diamond-League.png";
  if(s.includes("ruby"))return LEAGUE_ICON_BASE+"Ruby-League.png";
  if(s.includes("sapphire"))return LEAGUE_ICON_BASE+"Sapphire-League.png";
  if(s.includes("crystal"))return LEAGUE_ICON_BASE+"Crystal-League.png";
  if(s.includes("emerald"))return LEAGUE_ICON_BASE+"Emerald-League.png";
  if(s.includes("gold"))return LEAGUE_ICON_BASE+"Gold-League.png";
  return EFPL_LOGO;
}

function showTab(id){
  ["leaderboard","history","stats"].forEach(pid=>byId(pid).hidden=(pid!==id));
  document.querySelectorAll(".tab").forEach(b=>b.classList.toggle("active",b.dataset.tab===id));
}

function parseHistory(gvData){
  const headers=(gvData.table.cols||[]).map(c=>(c.label||"").trim());
  const rows=(gvData.table.rows||[]).map(r=>(r.c||[]).map(val));
  const cleanRows=rows
    .filter(r=>r&&r.some(x=>String(x??"").trim()!==""))
    .map(r=>({season:key(r[0]),cells:r.map(v=>normName(v))}))
    .filter(r=>r.season);
  return{headers,rows:cleanRows};
}

function buildCompetitions(headers){
  const comps=[];
  for(let i=1;i<headers.length;i++){
    const label=headers[i]||`Col ${i+1}`;
    comps.push({label,index:i});
  }
  return comps;
}

function computeAllTimeCounts(){
  const countsByPlayer=new Map();
  const breakdownByPlayer=new Map();
  HISTORY.rows.forEach(r=>{
    COMPETITIONS.forEach(c=>{
      const winner=normName(r.cells[c.index]);
      if(!winner)return;
      countsByPlayer.set(winner,(countsByPlayer.get(winner)||0)+1);
      if(!breakdownByPlayer.has(winner))breakdownByPlayer.set(winner,new Map());
      const m=breakdownByPlayer.get(winner);
      m.set(c.label,(m.get(c.label)||0)+1);
    });
  });
  return{countsByPlayer,breakdownByPlayer};
}

const fly=byId("flyout");
const isMobile='ontouchstart'in window;

function showFlyout(name,anchor){
  const total=COUNTS.countsByPlayer.get(name)||0;
  const m=COUNTS.breakdownByPlayer.get(name);
  const rows=m?[...m.entries()].map(([comp,count])=>({comp,count})):[];
  rows.sort((a,b)=>b.count-a.count||a.comp.localeCompare(b.comp));

  fly.innerHTML=`
    <div class="flyout-header">
      <div class="flyout-name">${esc(name)}</div>
      <div class="flyout-subtitle">Career Trophy Breakdown</div>
    </div>
    <div class="flyout-stats">
      <div class="flyout-stat">
        <div class="flyout-stat-label">Total</div>
        <div class="flyout-stat-value">${total}</div>
      </div>
      <div class="flyout-stat">
        <div class="flyout-stat-label">Types</div>
        <div class="flyout-stat-value">${rows.length}</div>
      </div>
    </div>
    <div class="flyout-breakdown">
      ${rows.length?rows.slice(0,8).map(x=>`
        <div class="flyout-item">
          <div class="comp-name">
            <img class="comp-icon" src="${esc(compIconUrl(x.comp))}" alt="">
            <span style="font-size:13px;font-weight:600">${esc(x.comp)}</span>
          </div>
          <span class="badge secondary">${x.count}</span>
        </div>
      `).join(""):'<div style="text-align:center;color:var(--ink-muted);font-size:13px">No trophies</div>'}
    </div>
  `;

  fly.style.display="block";
  
  if(isMobile){
    fly.style.left="50%";
    fly.style.top="50%";
    fly.style.transform="translate(-50%,-50%)";
  }else{
    const rect=anchor.getBoundingClientRect();
    const scrollY=window.scrollY||0;
    const vw=document.documentElement.clientWidth;
    const w=fly.offsetWidth||280;
    let left=rect.right+10;
    if(left+w>vw-10)left=Math.max(10,rect.left-w-10);
    fly.style.left=left+"px";
    fly.style.top=(rect.top+scrollY-8)+"px";
    fly.style.transform="none";
  }
}

function hideFlyout(){fly.style.display="none";}

function renderLeaderboard(){
  const entries=[...COUNTS.countsByPlayer.entries()]
    .map(([name,count])=>({name,count}))
    .sort((a,b)=>b.count-a.count||a.name.localeCompare(b.name));

  const totalTrophies=[...COUNTS.countsByPlayer.values()].reduce((a,b)=>a+b,0);

  byId("quick-players").textContent=entries.length;
  byId("quick-trophies").textContent=totalTrophies;
  byId("quick-seasons").textContent=HISTORY.rows.length;
  byId("quick-comps").textContent=COMPETITIONS.length;

  let html=`
    <thead>
      <tr>
        <th style="width:60px">RANK</th>
        <th>PLAYER</th>
        <th class="center" style="width:120px">TROPHIES</th>
        <th>TOP TITLES</th>
      </tr>
    </thead>
    <tbody>
  `;

  entries.forEach((r,i)=>{
    const rankClass=i===0?'gold':i===1?'silver':i===2?'bronze':'';
    const topTitles=(() => {
      const m=COUNTS.breakdownByPlayer.get(r.name);
      if(!m)return"-";
      const top=[...m.entries()]
        .map(([comp,count])=>({comp,count}))
        .sort((a,b)=>b.count-a.count)
        .slice(0,2);
      return top.map(x=>`${x.comp} (${x.count})`).join(", ");
    })();

    html+=`
      <tr>
        <td class="center"><div class="rank ${rankClass}">${i+1}</div></td>
        <td><span class="player-link" data-player="${esc(r.name)}">${esc(r.name)}</span></td>
        <td class="center"><span class="badge primary">${r.count}</span></td>
        <td style="color:var(--ink-muted);font-size:13px">${esc(topTitles)}</td>
      </tr>
    `;
  });

  html+=`</tbody>`;
  byId("t-leader").innerHTML=html;

  document.querySelectorAll("#leaderboard .player-link").forEach(el=>{
    const name=el.dataset.player;
    el.addEventListener("click",()=>showFlyout(name,el));
    if(!isMobile){
      el.addEventListener("mouseenter",()=>showFlyout(name,el));