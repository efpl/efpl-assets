<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>eFPL Hall of Fame</title>

<link rel="preconnect" href="https://docs.google.com" crossorigin>
<link rel="preconnect" href="https://www.google.com" crossorigin>

<style>
:root{
  --bg: transparent;
  --card:#00143b;
  --text:#ffffff;
  --muted:#cbd5e1;

  --header-bg:#f9d71c;
  --header-text:#00143b;

  --row1:#001a4d;
  --row2:#002060;
  --hover:#002b80;

  --accent:#f9d71c;
}

html,body{background:var(--bg);}
body{margin:0;font:14px/1.45 "Segoe UI",Arial,sans-serif;color:var(--text);}

.wrap{max-width:1100px;margin:20px auto;padding:14px;}
.card{background:var(--card);border-radius:12px;overflow:hidden;box-shadow:0 10px 30px rgba(0,0,0,.25);}

.title{
  display:flex;justify-content:space-between;align-items:center;
  padding:12px 14px;border-bottom:1px solid rgba(249,215,28,.22);
}
.title h1{font-size:18px;margin:0}
.badge{background:var(--accent);color:#000;padding:4px 10px;border-radius:999px;font-weight:800;font-size:11px}

/* Tabs */
.tabs{
  display:flex;gap:8px;padding:10px 14px;border-bottom:1px solid rgba(255,255,255,.08);
}
.tab{
  border:1px solid rgba(249,215,28,.25);
  background:rgba(5,34,90,.35);
  color:var(--text);
  padding:6px 12px;border-radius:999px;
  font-weight:800;font-size:12px;cursor:pointer;
}
.tab.active{
  background:rgba(249,215,28,.18);
  border-color:rgba(249,215,28,.75);
}

.panel{padding:12px 14px}
.panel[hidden]{display:none}

/* Filter */
.filter{
  display:flex;align-items:center;gap:8px;margin-bottom:8px;
}
.filter label{font-size:12px;color:var(--muted)}
.filter select{
  background:#05225a;color:#fff;border:1px solid rgba(255,255,255,.2);
  border-radius:8px;padding:4px 8px;font-size:12px;
}

/* Tables */
table{width:100%;border-collapse:collapse}
thead th{
  background:var(--header-bg);color:var(--header-text);
  font-size:11px;text-transform:uppercase;letter-spacing:.04em;
  padding:8px;text-align:center;
}
tbody td{
  padding:10px;text-align:center;font-weight:600;
}
tbody tr:nth-child(odd){background:var(--row1)}
tbody tr:nth-child(even){background:var(--row2)}
tbody tr:hover{background:var(--hover)}
td:first-child{font-weight:800}

/* Leaderboard highlight */
tbody tr.pos-1 td{
  background:linear-gradient(90deg, rgba(249,215,28,.2), rgba(249,215,28,.08)) !important;
}

/* Desktop / mobile */
.desktop-only{display:block}
.mobile-only{display:none}

/* ===== MOBILE ===== */
@media(max-width:680px){
  .desktop-only{display:none}
  .mobile-only{display:block}

  .history-card{
    border:1px solid rgba(255,255,255,.15);
    border-radius:12px;margin-bottom:10px;overflow:hidden;
  }
  .history-header{
    padding:10px;font-weight:900;
    display:flex;justify-content:space-between;align-items:center;
    cursor:pointer;background:#05225a;
  }
  .history-header span{color:var(--accent)}
  .history-body{display:none;padding:10px}
  .history-item{
    display:flex;justify-content:space-between;
    padding:6px 0;border-bottom:1px dashed rgba(255,255,255,.15);
    font-size:13px;
  }
  .history-item:last-child{border-bottom:none}
}
</style>
</head>

<body>
<div class="wrap">
<div class="card">

<div class="title">
  <h1>üèÜ eFPL Hall of Fame</h1>
  <span class="badge" id="updated">Loading‚Ä¶</span>
</div>

<div class="tabs">
  <button class="tab active" onclick="showTab('history')">Season History</button>
  <button class="tab" onclick="showTab('leaderboard')">Leaderboard</button>
</div>

<div class="panel" id="history">
  <div class="filter">
    <label for="seasonFilter">Season</label>
    <select id="seasonFilter" onchange="applyFilter()">
      <option value="all">All seasons</option>
    </select>
  </div>

  <div class="desktop-only">
    <table id="t-history"></table>
  </div>

  <div class="mobile-only" id="historyCards"></div>
</div>

<div class="panel" id="leaderboard" hidden>
  <table id="t-leader"></table>
</div>

</div>
</div>

<script>
const SHEET_ID="1DaYTkVVWiQVg7aianACoIfxXBZSKYqtycyuofX8WXj8";
const HISTORY_GID="1032615815";
const LEADER_GID="1964938799";

let historyData=null;

function gv(gid,range){
  return fetch(`https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&gid=${gid}&range=${range}`)
    .then(r=>r.text())
    .then(t=>JSON.parse(t.slice(t.indexOf('{'),t.lastIndexOf('}')+1)));
}

function esc(s){
  return String(s ?? '').replace(/[&<>"]/g,m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;' }[m]));
}

/* Preserve 0, only blank null/undefined */
function val(c){
  return (c && (c.v ?? c.f)) ?? "";
}

/* Normalize for filtering (handles numbers/strings/spaces) */
function key(x){
  return String(x ?? "").trim();
}

function renderHistory(filter="all"){
  const cols = (historyData.table.cols || []).map(c => c.label || "");
  const rows = (historyData.table.rows || []).map(r => (r.c || []).map(val));
  const frows = rows.filter(r => filter === "all" || key(r[0]) === key(filter));

  // desktop table
  let h = "<thead><tr>" + cols.map(c=>`<th>${esc(c)}</th>`).join("") + "</tr></thead><tbody>";
  frows.forEach(r=>{
    h += "<tr>" + r.map(v=>`<td>${esc(v)}</td>`).join("") + "</tr>";
  });
  h += "</tbody>";
  document.getElementById("t-history").innerHTML = h;

  // mobile cards (accordion)
  let m = "";
  frows.forEach(r=>{
    m += `<div class="history-card">
      <div class="history-header" onclick="this.nextElementSibling.style.display=this.nextElementSibling.style.display?'':'block'">
        ${esc(r[0])} <span>‚ñº</span>
      </div><div class="history-body">`;

    r.slice(1).forEach((v,i)=>{
      if(String(v).trim() !== ""){
        m += `<div class="history-item"><span>${esc(cols[i+1])}</span><strong>${esc(v)}</strong></div>`;
      }
    });

    m += "</div></div>";
  });
  document.getElementById("historyCards").innerHTML = m;
}

function applyFilter(){
  renderHistory(document.getElementById("seasonFilter").value);
}

function showTab(id){
  document.getElementById("history").hidden = id !== "history";
  document.getElementById("leaderboard").hidden = id !== "leaderboard";
}

(async()=>{
  historyData = await gv(HISTORY_GID, "A1:L");

  const seasons = [...new Set(
    (historyData.table.rows || []).map(r => key(val((r.c || [])[0])))
  )].filter(s => s);

  const sel = document.getElementById("seasonFilter");
  seasons.forEach(s => {
    sel.innerHTML += `<option value="${esc(s)}">${esc(s)}</option>`;
  });

  renderHistory();

  const lb = await gv(LEADER_GID, "A1:E");
  let l = "<thead><tr>" + (lb.table.cols || []).map(c=>`<th>${esc(c.label || "")}</th>`).join("") + "</tr></thead><tbody>";

  (lb.table.rows || []).forEach((r,i)=>{
    const cells = (r.c || []).map(val);
    l += `<tr class="${i===0?'pos-1':''}">` + cells.map(v=>`<td>${esc(v)}</td>`).join("") + "</tr>";
  });

  l += "</tbody>";
  document.getElementById("t-leader").innerHTML = l;

  document.getElementById("updated").textContent = "Updated";
})();
</script>


</body>
</html>
