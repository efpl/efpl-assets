<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>eFPL Fixtures</title>
<meta name="color-scheme" content="dark">
<link rel="preconnect" href="https://docs.google.com" crossorigin>
<link rel="preconnect" href="https://www.google.com" crossorigin>

<style>
  :root{
    --bg:#00143b;
    --card:#05225a;
    --ink:#ffffff;
    --accent:#f9d71c;
    --line:rgba(249,215,28,.35);
  }
  html,body{background:transparent}
  body{margin:0;font:16px/1.45 system-ui,Segoe UI,Roboto,Arial,sans-serif;color:var(--ink)}
  .wrap{max-width:900px;margin:18px auto;padding:12px;background:var(--bg);border-radius:14px;border:1px solid var(--line)}

  /* header old style */
  .title{text-align:center;margin:0 0 14px}
  .eyebrow{background:var(--accent);color:#00143b;padding:4px 14px;border-radius:999px;font-weight:900;font-size:13px;text-transform:uppercase}
  .title h1{margin:8px 0 0;font-size:22px;font-weight:900}

  table{width:100%;border-collapse:separate;border-spacing:0 8px}
  tbody td{
    border:1px solid var(--line);
    padding:10px 12px;
    font-weight:700;
  }
  tbody tr td:first-child{border-radius:10px 0 0 10px}
  tbody tr td:last-child{border-radius:0 10px 10px 0}

  .home{background:var(--accent);color:#00143b;text-align:right}
  .mid{background:var(--card);text-align:center;width:80px;color:#fff}
  .away{background:var(--accent);color:#00143b;text-align:left}

  /* Mid-season divider */
  .milestone-row td{
    background:#05225a;
    color:#f9d71c;
    text-align:center;
    font-weight:900;
    border:1px solid var(--line);
    padding:10px 12px;
    border-radius:10px !important;
  }

  .milestone-chip{
    display:inline-block;
    padding:3px 12px;
    border-radius:999px;
    background:#f9d71c;
    color:#00143b;
    font-weight:900;
    letter-spacing:.03em;
  }

  .status{color:#cbd5e1;text-align:center;margin:10px 0 0;font-size:14px}

  @media (max-width:680px){
    .wrap{padding:10px}
    body{font-size:14px;line-height:1.35}
    .title h1{font-size:18px}
    tbody td{padding:8px}
    .mid{width:64px}
  }
</style>
</head>
<body>
  <div class="wrap">
    <div class="title">
      <span class="eyebrow">Fixtures</span>
      <h1>Current Season</h1>
    </div>

    <table id="fixturesTable" aria-describedby="status">
      <tbody></tbody>
    </table>

    <div id="status" class="status">Loading…</div>
  </div>

<script>
(function(){
  const SHEET_ID = '1pPQbrjEivgy88KtyVe5ABsKjQSDutZwEO51TgKIPF5E';
  const SHEET_NAME = 'Fixtures (Embed)';
  const RANGE = 'A1:C241';
  const MID_AFTER = 45; // ✅ divider after 45 fixtures

  const statusEl = document.getElementById('status');
  const tbody = document.querySelector('#fixturesTable tbody');

  const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=${encodeURIComponent(SHEET_NAME)}&range=${encodeURIComponent(RANGE)}`;

  function parseGViz(text){
    const start = text.indexOf('{');
    const end   = text.lastIndexOf('}');
    if(start === -1 || end === -1) throw new Error('Bad GViz response');
    return JSON.parse(text.slice(start, end+1));
  }

  function insertMilestoneRow(){
    const tr = document.createElement('tr');
    tr.className = 'milestone-row';
    const td = document.createElement('td');
    td.colSpan = 3;
    td.innerHTML = '<span class="milestone-chip">MID-SEASON CHECKPOINT</span>';
    tr.appendChild(td);
    tbody.appendChild(tr);
  }

  function build(rows){
    tbody.innerHTML = '';
    let rendered = 0;

    for(let i = 0; i < rows.length; i++){
      const r = rows[i] || [];
      const home = (r[0]||'').toString().trim();
      const mid  = (r[1]||'').toString().trim();
      const away = (r[2]||'').toString().trim();
      if(!home && !mid && !away) continue;

      if(home === '#MID'){ insertMilestoneRow(); continue; }
      if(rendered === MID_AFTER){ insertMilestoneRow(); }

      const tr = document.createElement('tr');
      const tdHome = document.createElement('td'); tdHome.className='home'; tdHome.textContent = home;
      const tdMid  = document.createElement('td');  tdMid.className='mid';  tdMid.textContent = mid;
      const tdAway = document.createElement('td'); tdAway.className='away'; tdAway.textContent = away;
      tr.appendChild(tdHome); tr.appendChild(tdMid); tr.appendChild(tdAway);
      tbody.appendChild(tr);

      rendered++;
    }

    statusEl.textContent = rendered ? '' : 'No fixtures found.';
  }

  fetch(url)
    .then(r => r.text())
    .then(txt => {
      const data = parseGViz(txt);
      const rows = (data.table.rows||[]).map(row => (row.c||[]).map(cell => (cell ? cell.v : '')));
      build(rows);
    })
    .catch(err => { console.error(err); statusEl.textContent = 'Error loading fixtures.'; });
})();
</script>
</body>
</html>
